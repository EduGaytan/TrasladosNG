<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=58mm, initial-scale=1.0">
    <title>Ticket de Traslado</title>

    <style>
        /* --- CONFIGURACIÓN DE PÁGINA --- */
        @page {
            margin: 0;
            size: 58mm auto;
        }
        body {
            margin: 0;
            padding: 2mm 0 2mm 1mm; 
            width: 58mm;
            background-color: #fff;
        }
        .ticket-container {
            width: 48mm; 
            text-align: left;
        }

        /* --- TIPOGRAFÍA --- */
        * {
            font-family: Arial, Helvetica, sans-serif; 
            font-size: 12px;
            color: #000;
            box-sizing: border-box;
            font-weight: 600;
            line-height: 1.15;
        }

        /* --- LOGO --- */
        .svg-container {
            width: 100%;
            text-align: center;
            margin-bottom: 2mm;
        }
        #logo {
            max-width: 95%;
            height: auto;
        }

        /* --- TÍTULO PRINCIPAL --- */
        .main-title {
            font-size: 16px !important;
            font-weight: 900 !important;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 3mm;
        }
        
        /* --- INFO TICKET (Fecha, Origen, Destino) --- */
        .info-line {
            display: flex;
            justify-content: space-between;
            margin: 1px 0;
        }
        .info-line span {
            font-size: 12px;
        }

        /* --- TABLA DE ARTÍCULOS --- */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 2mm 0;
        }
        .items-table th {
            border-bottom: 1px dashed #000;
            text-align: right;
            padding-bottom: 1mm;
            font-size: 11px;
        }
        
        /* Ajuste de columnas (sin subtotal) */
        .col-desc { text-align: left; width: 60%; }
        .col-qty  { text-align: center; width: 15%; }
        .col-price { text-align: right; width: 25%; }

        .items-table td {
            padding: 2px 0;
            vertical-align: top;
            font-size: 12px;
            word-wrap: break-word;
        }

        /* --- SEPARADOR --- */
        .separator {
            border-top: 1px dashed #000;
            margin: 2mm 0;
        }

        /* --- RESUMEN FINAL Y FIRMA --- */
        .final-summary p {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 13px;
        }
        .final-summary p span:first-child {
            text-align: right;
            padding-right: 4px;
        }
        .final-summary p span:last-child {
            text-align: right;
        }
        .text-lg { font-size: 14px !important; font-weight: 800; }

        .signature-section {
            margin-top: 8mm;
            text-align: center;
        }
        .signature-section p {
            margin: 1px 0;
            font-size: 12px;
        }

        /* --- PIE DE PÁGINA --- */
        .ticket-footer {
            text-align: center;
            margin-top: 5mm;
        }
        .ticket-footer p {
            font-size: 11px;
            margin: 2px 0;
        }
    </style>
</head>

<body>
    <div class="ticket-container">
        <!-- LOGO -->
        <div class="svg-container">
            <svg id="logo" version="1.0" xmlns="http://www.w3.org/2000/svg" width="100%" height="auto" viewBox="0 0 1280 180" preserveAspectRatio="xMidYMid meet">
                <!-- Tu código SVG va aquí -->
            </svg>
        </div>

        <!-- TÍTULO -->
        <div class="main-title">
            Traslado de Mercancía
        </div>

        <!-- INFO TRASLADO -->
        <div class="info-line">
            <span>Fecha y Hora:</span>
            <span id="FechaHora_id"></span>
        </div>
        <div class="info-line">
            <span>Desde:</span>
            <span id="Desde_id"></span>
        </div>
        <div class="info-line">
            <span>Hacia:</span>
            <span id="Hacia_id"></span>
        </div>

        <!-- PRODUCTOS -->
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-desc">Descripción</th>
                    <th class="col-qty">Cant</th>
                    <th class="col-price">P.U.</th>
                </tr>
            </thead>
            <tbody id="tablaBody"></tbody>
        </table>

        <div class="separator"></div>

        <!-- RESUMEN FINAL -->
        <div class="final-summary">
            <p class="text-lg">
                <span>Cantidad de Piezas:</span>
                <span id="Cantidad_Total_id"></span>
            </p>
            <p class="text-lg">
                <span>Valor Total Mercancía:</span>
                <span id="Monto_Total_id"></span>
            </p>
        </div>

        <!-- FIRMA -->
        <div class="signature-section">
            <p>_________________________</p>
            <p>Firma de Recibido</p>
        </div>

        <!-- PIE -->
        <div class="ticket-footer">
            <p>Verificar mercancía al recibir.</p>
        </div>
    </div>

    <script>
        // --- 1. LECTURA DE DATOS ---
        const params = new URLSearchParams(window.location.search);
        const getP = (name, def = "") => params.has(name) ? decodeURIComponent(params.get(name)) : def;
        const money = (num) => "$" + (parseFloat(num) || 0).toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        
        const trasladoData = {
            fecha: getP('FechaHora'),
            desde: getP('Desde'),
            hacia: getP('Hacia'),
            cantidadTotal: getP('Cantidad_Total', '0'),
            montoTotal: getP('Monto_Total', '0'),
            titulos: getP('Titulo', '').split(','),
            cantidades: getP('Cantidad', '').split(','),
            precios: getP('Precio', '').split(',')
        };

        // --- 2. RENDERIZADO DE DATOS FIJOS ---
        document.getElementById("FechaHora_id").textContent = trasladoData.fecha;
        document.getElementById("Desde_id").textContent = trasladoData.desde;
        document.getElementById("Hacia_id").textContent = trasladoData.hacia;

        // --- 3. GENERAR LISTA DE PRODUCTOS ---
        const tablaBody = document.getElementById("tablaBody");
        trasladoData.titulos.forEach((titulo, index) => {
            if(titulo) {
                let cantidad = trasladoData.cantidades[index] || 1;
                let precio = trasladoData.precios[index] || 0;
                let row = document.createElement("tr");
                row.innerHTML = `
                    <td class="col-desc">${titulo}</td>
                    <td class="col-qty">${cantidad}</td>
                    <td class="col-price">${money(precio)}</td>
                `;
                tablaBody.appendChild(row);
            }
        });

        // --- 4. RENDERIZADO DE TOTALES FINALES ---
        document.getElementById("Cantidad_Total_id").textContent = trasladoData.cantidadTotal;
        document.getElementById("Monto_Total_id").textContent = money(trasladoData.montoTotal);

        // --- 5. IMPRIMIR Y CERRAR ---
        window.onload = function() {
            setTimeout(function() {
                window.print();
                setTimeout(function() {
                    window.close();
                }, 1000);
            }, 500);
        }
    </script>
</body>
</html>
